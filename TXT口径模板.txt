《统一通用口径：TXT 口径模板（V4，一次性扫描→破3转双边连续｜新单双边口径）》 （覆盖过去与未来所有结构模型）

目标：

【版本水印（交付验收用｜锁死）】

水印：🍔🍔🍔

交付首屏必须原样打印以上水印；缺失=默认串台/旧版本=直接作废。

【旧统计块黑名单（交付验收｜一票否决）】

只要交付输出中出现任一关键词：同向= / 均差方向 → 视为沿用旧“均差方向”统计块，判【口径污染】→ 直接作废。

均差新口径必须输出并可检索到：mean=0、|均差|<3、|均差|≥3、有效转向（|均差|≥1）。

【必出输出块标题（交付验收｜锁死）】

交付报告中必须出现以下标题（原样可检索）： 1）均差分桶统计（mean=0 / |均差|<3 / |均差|≥3） 2）均差有效转向统计（|均差|≥1 跨符号）

缺任一标题：视为未按骨架输出 → 直接作废。

【交付模板（锁死｜统一）】

交付物：单个TXT文档（TXT内包含可直接运行的完整Python代码）。

使用方式：复制TXT内容→粘贴到任意 .py 文件→放在CSV数据目录运行。

数据读取：只读取当前目录全部 .csv；自动识别列名；只读不算（禁止重算/推导/窗口/rolling）。

依赖限制：禁止依赖脚本名称定位；禁止分文件工程；禁止读取任何外部配置/资源/模板文件。

写入限制：运行过程中禁止创建/写入任何新文件或目录（含日志/缓存/输出/中间文件）。

输出规范：控制台打印固定报告块；首屏必须打印“监测开关=开/关”；进度每处理10个CSV文件输出1行。
- 动态水印挂载：除了首屏报告必须打印水印外，引擎在窗口内的每一轮对话交互，均须以“水印组”作为回复开端，确认为当前母版激活状态。

可变范围：仅允许修改 run_strategy_on_boot(records) 内策略逻辑；其余模块一律锁死。

这份口径作为“底层通用规则”，覆盖过去与未来所有结构模型。

任意策略只需要在 run_strategy_on_boot(records) 内写“结构/过滤/投放”，其余不改。

============================== 0）核心术语（必须锁死）
结果 r：只允许 'B' / 'P' / 'T'

映射：庄→B，闲→P，和→T

点差 diff：int（原始读取，不重算）

变化率 rate：float 或 None（原始读取，不计算）

均差 mean：float 或 None（原始读取，不计算）

【口位术语（必须锁死）】
神谕标签 (Oracle Label)：物理位置在 ⭐，用于标注“若此处激活，后续 4 口内的最终状态”。反向归因 (Reverse Attribution)：以执行结果为基准，回溯至 ⭐ 投放点读取原始均差/点差分桶指标的操作。结算口 (Settlement)：物理行随投放层级推进（$idx+0 \dots 3$），仅负责读取结果，不负责决策。

对外讨论与口径只承认两个名词：⭐ / 投放点。

⭐属于投放点（用于描述结构来源）。

其他口位均属于程序内部推进与结算阶段：不命名、不输出、不进入人类演练口径。

============================== 累计口径统一（禁止跨段累计｜锁死）
本模板中出现的“累计/破3/≥3”，一律按【段长】理解（同一方连续长度），禁止把不同段的次数相加。

T 不计入段长且不打断段（方向保持为上一个非T）。

============================== 批次完整性硬闸门（唯一单位锁定｜锁死）物理对标：1 批次 (Batch) $\equiv$ 1 原始靴 (Shoe) $\equiv$ 1 完整且不可分割的物理演化单元。禁止拆分：严禁将单靴数据拆分为多个子批次 (Sub-Batch) 进行独立扫描。逻辑连续性：任何 Sub-Batch 字段仅允许作为属性标签读取，严禁破坏 Batch 的物理连贯性。闸门权重：所有扫描起点、前 9 口过滤、自停逻辑，必须以 Batch 为唯一物理边界进行判定。
============================== 批次级过滤（前9口｜段长口径｜锁死）
入口口号未满9：本批次不参与（不扫描/不激活/不统计交易）

不可打批次：前9口内，B最大段长≥3 且 P最大段长≥3 → 整批次禁用

其余情况：可参与批次（进入结构扫描）

============================== 扫描起点与一次性锁死（永久硬规则）
扫描起点（锁死）：

扫描从“批次首第一行”开始（严格零未来）。

seen_all：B/P/T 都算一口；用于批次级开关与投放点合法性。

交易闸门：seen_all < 9 禁止任何激活行为。

扫描方式（锁死）：

只允许：一次性扫描

禁用：持续扫描

禁用：一次性扫描+持续扫描

每批次最多1次交易：一旦出现首个合法投放点并结束（过滤失败/观察终止/激活失败/匹配达成/阈值击穿止）→ 立即结束本批次。

提前候选（锁死）：

seen_all < 9 内出现的投放点候选/激活点候选：一律忽略但不结束本批次（继续扫）。

自停（过程闸门｜锁死｜从批次首开始生效）：

在首个合法投放点出现之前：

一旦两边都曾出现“段长≥3”（同一方连续非状态 T 口≥3；状态 T 位移零偏差） → 立即结束本批次扫描（不激活、不统计）。

同方向刷新（锁死）：

在首个合法投放点出现之前：

出现同方向段长≥3 → 视为强段刷新，继续等待新的结构再次产生投放点（仍须 seen_all≥9 才合法）。

【通用神谕审计接口（入口门禁）】

审计时机：固定在结构激活后的 ⭐ 投放点（idx）。

审计职能：读取该行原始指标，由策略决定是否准入。

物理锁死：若审计输出为“不准入”，程序必须放弃本次执行，并立即寻找该批次（Batch）内下一个合法结构。

============================================================ 【决策口升级补丁（锁死）】
决策口基准：任意判断/过滤/监测/止损/归因，只允许在投放点当下读取该行及历史指标；严禁读取投放点之后（t+1及以后）的任何信息用于决策。

程序内部执行/结算阶段：只允许读取结果用于结算与推进；禁止读取任何指标（点差/变化率/均差）。

【程序级硬闸门（锁死｜A+B）】

必须同时具备： A）指标读取门禁（仅允许在投放点当下读取指标；其余阶段触碰指标=违规阻断） B）阶段状态机（扫描/决策/执行/结算分档；执行/结算阶段指标访问=违规阻断）

C）字段剥离：可选加固（执行/结算阶段数据对象不携带指标字段）。

【多次决策（动态监测/动态止损）｜锁死】

“多次决策”仅指：同一笔交易内，随着投放量推进（含状态 T 导致的重复投放），在每一次【实际投放前】都允许重新做一次“继续/STOP”的决定。

每一次【实际投放前】的决定时刻，视为一次“投放点”（决策口）：只允许读取该行及历史的指标与结果；严禁读取该决策口之后（t+1及以后）的任何信息用于决策。

决策之后立即进入“程序内部推进与结算阶段”：只允许读取结果用于结算与推进；禁止读取任何指标（点差/变化率/均差）。

多次决策不得改变：一次性扫描｜每批次最多1次交易｜前9口批次级过滤｜段长口径｜自停 等全部锁死规则；仅允许产生“提前止损退出”，并用于路径快照归因统计。

以1-2-4-8为例：每次“实际投放前”的投放决策当下记录一次指标快照。

若遇状态 T 导致同一投放量需要重复投放：每次重复投放前也必须记录一条快照（因此快照条数≥4）。

阈值击穿后归因/分桶统计只允许使用这些快照；禁止阈值击穿后回头读取原始指标解释路径。

【双快照趋势审计协议（通用阻断）】 * 快照源列表：系统必须维护一个 snapshots 列表，存储每次“实际投放前”的指标快照。 

二连对比机制：在执行动态阻断决策时，允许策略对比“当前快照 (idx)”与“上一有效投放前快照 (last_bet_idx)”。 * 指标透明化：口径仅提供 abs(Diff) 变化、Rate 变化、Mean 转向（符号翻转且两侧绝对值 >= 1）等通用物理量的计算接口。

【决策口拦截动作规范】 * 拦截触发：当满足策略设定的阻断条件时，决策口 3/4 必须执行 STOP。 

物理清理：一旦触发 STOP，必须记录“提前止损”并立即结束本批次 (Batch) 扫描。


【连续统计（两指标二连变化）｜锁死】

目标：在“多次决策/路径快照（口径B）”基础上，输出可用于AI分析的【二指标二连变化】分布，用于寻找“STOP 机会”。

输出形态：只输出分布/榜单，不输出任何逐条样本流水（默认零样本）。

【连续统计数据源（锁死）】

连续统计只允许基于“路径快照列表”做事后汇总；禁止在连续统计阶段回读 records/原始行指标。

STOP 决策（若启用）：只允许使用“当前实际投放前快照 + 历史快照（例如上一快照）”；严禁读取下一次投放前快照用于决定本次是否 STOP。

【变化率 rate（二连口径）】

取值：投放点当行原始 rate，只读不算。

深度加权阶段定义：发生过一次不匹配之后进入下一投放量。

激活阈值（三档）：rate<=-3 / (-3,-2] / (-2,0)（激活阶段只看是否跨阈值）。

快照监测阈值（三档）：rate<0 / 0<=rate<+2 / rate>=+2（深度加权阶段用于连续观察）。

二连信号（只看相邻两次实际投放前快照）：趋势（变大/变小/不变）+ 跨0（负→非负 / 非负→负）。

【均差 mean（二连口径）】

取值：投放点当行原始 mean，只读不算。

分桶（锁死）：mean=0 单列；|mean|<3 且 mean≠0；|mean|>=3。

二连信号（只看相邻两次实际投放前快照）：

|mean|趋势（变大/变小/不变）

跨阈值（|mean|<3 ↔ |mean|>=3）

有效转向：mean 正负翻转，且两侧 |mean|>=1（例如 +1→-2）。

【二指标二连变化（默认输出两套）】

指标①：|点差|桶（1..9）

指标②A：rate监测桶（<0 / [0,+2) / >=+2）

指标②B：mean桶（mean=0 / |mean|<3 / |mean|>=3）

统计：按“第 n 次实际投放”分层（含状态 T 导致的重复投放）；输出每层 TopK 转移榜单（出现次数≥门槛才输出），字段至少包含：出现次数、后续阈值击穿数、后续阈值击穿率。

【验真分拆（仅验真阶段）】

允许按文件名排序做50/50确定性分拆；仅验真阶段启用。

首屏取消显示“验真分拆开关：是/否”（不影响分拆本身）。